---
title: ä¸€é”®ç©¿è¶Šåˆ°2020-12-31
category:
  - æŠ€æœ¯
  - Java
comments: false
tags:
  - Java
  - çŸ¥è¯†ç¢ç‰‡
abbrlink: 5cb164bd
date: 2020-01-02 14:12:20
---

ä»€ä¹ˆï¼Ÿä¸€é”®ç©¿è¶Šåˆ°2020-12-31ï¼Ÿä»€ä¹ˆå•Šã€‚ä»Šå¤©æ˜æ˜æ‰1æœˆ2å·ã€‚åˆšåˆšäº«å—è¿‡å…ƒæ—¦çš„å¿«ä¹ï¼Œä½ å°±å‘Šè¯‰æˆ‘åˆåˆ°å¹´åº•äº†ï¼Ÿ

nononoï¼Œå®é™…ä¸Šæ˜¯ä»Šå¤©æˆ‘åœ¨Vç«™çœ‹åˆ°äº†[è¿™ç¯‡å¸–å­](https://v2ex.com/t/633650)ã€‚è§‰å¾—å¾ˆæœ‰æ„æ€ã€‚æ‰€ä»¥æ‹¿æ¥åˆ†äº«ä¸€ä¸‹ã€‚

å†™ä»£ç çš„æ—¶å€™ï¼Œä½ å¸¸ç”¨çš„æ—¶é—´æ ¼å¼æ˜¯`YYYY-MM-dd`ï¼Œè¿˜æ˜¯`yyyy-MM-dd`å‘¢ï¼Ÿ

å¯èƒ½è¿™äº›çš„åŒºåˆ«ï¼Œä½ æ›¾ç»åœ¨ä¸Šè¯¾çš„æ—¶å€™å¬è€å¸ˆæèµ·è¿‡ã€‚ä¹Ÿå¯èƒ½ä½ ä»æ¥æ²¡æœ‰æ³¨æ„è¿‡ä»–ä»¬çš„åŒºåˆ«ã€‚ä½†æ˜¯æ— è®ºå¦‚ä½•ï¼Œä»Šå¹´å·²ç»2020äº†ã€‚ä½ å¯ä¸€å®šè¦ææ¸…æ¥šè¿™äº›çš„åŒºåˆ«ï¼

æˆ‘ä»¬å…ˆæ¥å¤ç°ä¸€ä¸‹è´´ä¸­çš„BUGï¼š

```java
    @Test
    void TestYearBug() {
        LocalDateTime before2020 = LocalDateTime.of(2019, Month.DECEMBER, 25, 8, 0, 0);
        for (int day = 0; day < 8; day++) {
            String dateFormatToString = before2020.format(DateTimeFormatter.ofPattern("YYYY-MM-dd"));
            System.out.println(dateFormatToString);
            before2020 = before2020.plusDays(1L);
        }
    }
```

å¦‚æœä½ ä¸è®¤å¾—LocalDateTimeå’ŒDateTimeFormatterçš„è¯ï¼Œé‚£ä½ çœŸçš„æ˜¯Outå•¦ï¼Œä¸è¦å†ç”¨Dateå’ŒSimpleDateFormatterå•¦ã€‚å¿«å»äº†è§£ä¸€ä¸‹è¿™ä¸¤ä¸ªå´­æ–°çš„ç±»å§ã€‚

è¯å½’æ­£é¢˜ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ç»“æœæ˜¯ä»€ä¹ˆï¼š

![ğŸ˜®](https://i.loli.net/2020/01/02/bO9fP4hQqUpYag8.png)

ä»€ä¹ˆé¬¼å•Šï¼Œä¸ºä»€ä¹ˆ2019-12-28ä¸‹é¢ç›´æ¥å°±æ˜¯2020-12-29äº†ï¼Ÿ

å…¶å®è¿™ä¸ªé—®é¢˜åœ¨ Stack OverFlow ä¸Šå¾ˆæ—©å°±æœ‰è®¨è®ºäº†ã€‚[Y returns 2012 while y returns 2011 in SimpleDateFormat](https://stackoverflow.com/questions/8686331/y-returns-2012-while-y-returns-2011-in-simpledateformat).

æˆ‘ä»¬å»[Java Doc](https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#patterns)ä¸Šç¿»ä¸€ç¿»ï¼Œå¾ˆå®¹æ˜“å°±æ‰¾åˆ°ç­”æ¡ˆäº†ï¼š`Y`æ˜¯â€œWeek-Based-Yearâ€ï¼Œè€Œ`y`æ˜¯â€œYearâ€ã€‚

é‚£ä»€ä¹ˆæ˜¯ â€œWeek-Based-Yearâ€å‘¢ï¼Œæˆ‘æ‰¾åˆ°çš„[ä¸€ç¯‡æ–‡ç« ](http://www.epochconverter.com/epoch/weeknumbers.php)ä¸­è¿™æ ·è§£é‡Šï¼š

> Week number according to the ISO-8601 standard, weeks starting on Monday. The first week of the year is the week that contains that year's first Thursday (='First 4-day week'). The highest week number in a year is either 52 or 53.

æ ¹æ® ISO-8601 æ ‡å‡†ï¼Œä¸€å‘¨å§‹äºå‘¨ä¸€ï¼Œä¸€å¹´çš„ç¬¬ä¸€å‘¨æ˜¯åŒ…å«è¿™ä¸€å¹´ç¬¬ä¸€ä¸ªæ˜ŸæœŸå››çš„é‚£ä¸€å‘¨ã€‚å› æ­¤ï¼Œ2020-01-02ï¼Œä¹Ÿå°±æ˜¯ä»Šå¤©ï¼Œæ˜¯å‘¨å››ã€‚å› æ­¤ï¼Œè¿™å‘¨å°±æ˜¯2020å¹´ç¬¬ä¸€å‘¨ã€‚æ‰€ä»¥ä½œä¸ºâ€œWeek Yearâ€ï¼Œ`YYYY`å°±ä¼šæŠŠåŒåœ¨æœ¬å‘¨çš„2019-....

å†™åˆ°è¿™é‡Œæˆ‘è¿·æƒ‘äº†ã€‚çœ‹çœ‹ä¸Šé¢çš„è¿è¡Œç»“æœã€‚å¦‚æœè¯´å› ä¸ºè¿™å‘¨æ˜¯2020ç¬¬ä¸€å‘¨ï¼Œæ‰€ä»¥æŠŠå‘¨ä¸€å‘¨äºŒçš„12-30ã€12-31å½’äº2020å¹´ï¼Œæˆ‘ç†è§£ã€‚ä½†æ˜¯12-29å‘¢ï¼Ÿå®ƒæ˜¯å±äºä¸Šå‘¨æ—¥å•Šï¼Ÿ

äºæ˜¯æˆ‘å°±å»æ‰¾äº†å…¶ä»–åœ°æ–¹çš„æ–‡ç« ï¼Œæœ€ååœ¨æ˜é‡‘çœ‹åˆ°æœ‰äººè¯´ï¼š`YYYY`æ˜¯`week-based-year`ï¼Œè¡¨ç¤ºï¼šå½“å¤©æ‰€åœ¨çš„å‘¨å±äºçš„å¹´ä»½ï¼Œä¸€å‘¨ä»å‘¨æ—¥å¼€å§‹ï¼Œå‘¨å…­ç»“æŸï¼Œåªè¦æœ¬å‘¨è·¨å¹´ï¼Œé‚£ä¹ˆè¿™å‘¨å°±ç®—å…¥ä¸‹ä¸€å¹´ã€‚æ‰€ä»¥2019å¹´12æœˆ29æ—¥é‚£å¤©åœ¨è¿™ç§è¡¨è¿°æ–¹å¼ä¸‹å°±å·²ç» 2020 å¹´äº†ã€‚

è¿™æ ·è¯´çš„è¯å°±è§£é‡Šäº†è¿è¡Œç»“æœäº†ã€‚ä½†æ˜¯æˆ‘åˆè¿è¡Œäº†ä¸€ä¸‹ä»£ç ï¼š

```java
    @Test
    void TestYearBug() {
        LocalDateTime before2020 = LocalDateTime.of(2019, Month.DECEMBER, 25, 8, 0, 0);
        for (int day = 0; day < 8; day++) {
            String dateFormatToString = before2020.format(DateTimeFormatter.ofPattern("YYYY-MM-dd w e E"));
            System.out.print("dayOfWeek:"+before2020.get(WeekFields.ISO.dayOfWeek())+" ");
            System.out.println(dateFormatToString);
            before2020 = before2020.plusDays(1L);
        }
    }
```

è¿è¡Œç»“æœå¦‚ä¸‹ï¼š

![ğŸ¤¨](https://i.loli.net/2020/01/02/bpD5NYwzUgdovlm.png)

éš¾é“è¿™ä¸æ˜¯æŒ‰ç…§ISO-8601æ¥çš„å—ï¼Ÿæ‰€ä»¥ä¸Šé¢æˆ‘é˜…è¯»ISOæ ‡å‡†çš„æ—¶å€™æ‰ä¼šè¢«è¿·æƒ‘ï¼Ÿ

è¿™å°±ç•™å¾…æ—¥åæˆ‘å»æ‰¾å¯»ç­”æ¡ˆäº†ã€‚

é™„è¡¨ï¼šAll letters 'A' to 'Z' and 'a' to 'z' are reserved as pattern letters. The following pattern letters are defined:

<pre>  Symbol  Meaning                     Presentation      Examples
  ------  -------                     ------------      -------
   G       era                         text              AD; Anno Domini; A
   u       year                        year              2004; 04
   y       year-of-era                 year              2004; 04
   D       day-of-year                 number            189
   M/L     month-of-year               number/text       7; 07; Jul; July; J
   d       day-of-month                number            10

   Q/q     quarter-of-year             number/text       3; 03; Q3; 3rd quarter
   Y       week-based-year             year              1996; 96
   w       week-of-week-based-year     number            27
   W       week-of-month               number            4
   E       day-of-week                 text              Tue; Tuesday; T
   e/c     localized day-of-week       number/text       2; 02; Tue; Tuesday; T
   F       week-of-month               number            3

   a       am-pm-of-day                text              PM
   h       clock-hour-of-am-pm (1-12)  number            12
   K       hour-of-am-pm (0-11)        number            0
   k       clock-hour-of-am-pm (1-24)  number            0

   H       hour-of-day (0-23)          number            0
   m       minute-of-hour              number            30
   s       second-of-minute            number            55
   S       fraction-of-second          fraction          978
   A       milli-of-day                number            1234
   n       nano-of-second              number            987654321
   N       nano-of-day                 number            1234000000

   V       time-zone ID                zone-id           America/Los_Angeles; Z; -08:30
   z       time-zone name              zone-name         Pacific Standard Time; PST
   O       localized zone-offset       offset-O          GMT+8; GMT+08:00; UTC-08:00;
   X       zone-offset 'Z' for zero    offset-X          Z; -08; -0830; -08:30; -083015; -08:30:15;
   x       zone-offset                 offset-x          +0000; -08; -0830; -08:30; -083015; -08:30:15;
   Z       zone-offset                 offset-Z          +0000; -0800; -08:00;

   p       pad next                    pad modifier      1

   '       escape for text             delimiter
   ''      single quote                literal           '
   [       optional section start
   ]       optional section end
   #       reserved for future use
   {       reserved for future use
   }       reserved for future use
 </pre>